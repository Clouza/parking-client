# Log rotation configuration for parking camera client
# Place this file in /etc/logrotate.d/parking-client

/var/log/parking-client/*.log {
    # rotate daily
    daily

    # keep 14 days of logs
    rotate 14

    # compress old logs
    compress

    # delay compression until next rotation
    delaycompress

    # don't error if log file is missing
    missingok

    # don't rotate empty files
    notifempty

    # create new log files with these permissions
    create 0644 pi pi

    # run this command after rotation
    postrotate
        # reload the service to reopen log files
        /bin/systemctl reload-or-restart parking-camera > /dev/null 2>&1 || true

        # clean up very old files (older than 30 days)
        find /var/log/parking-client -name "*.log.*" -mtime +30 -delete > /dev/null 2>&1 || true
    endscript

    # copy and truncate instead of moving (for active log files)
    copytruncate

    # set maximum size before forced rotation
    maxsize 100M

    # use date as suffix for rotated files
    dateext

    # format for date extension
    dateformat -%Y%m%d-%H%M%S
}

# Specific configuration for error logs
/var/log/parking-client/error.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0644 pi pi
    maxsize 50M
    dateext
    copytruncate
}

# Configuration for security audit logs
/var/log/parking-client/security_audit.log {
    weekly
    rotate 52
    compress
    delaycompress
    missingok
    notifempty
    create 0600 pi pi
    maxsize 10M
    dateext
    copytruncate
}